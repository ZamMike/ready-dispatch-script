ТЕХНИЧЕСКОЕ ЗАДАНИЕ: SELECT WEEK REPORT

  ОБЩЕЕ ОПИСАНИЕ

  Функция "Select WEEK Report (choose week)" создает отчеты для выбранной недели
   по всем командам (Team 1-5) с анализом статуса водителей и статистикой.

  ВХОДНЫЕ ДАННЫЕ

  - Исходные листы: Team 1, Team 2, Team 3, Team 4, Team 5
  - Структура каждого листа:
    - Строка 1: Заголовки
    - Колонка E: Dispatcher (диспетчер)
    - Колонка F: Driver (водитель)
    - Колонки дней недели (например AK-AQ): данные по дням
    - Колонка WEEK (например AS): недельный GROSS
    - Строки данных начинаются с UG_DATA_START_ROW (константа = 3)

  АЛГОРИТМ РАБОТЫ

  1. ПОИСК ДОСТУПНЫХ НЕДЕЛЬ

  - Сканирует все листы Team 1-5
  - Ищет заголовки вида "WEEK 35", "WEEK 36" в первой строке
  - Собирает список уникальных номеров недель
  - Сортирует по убыванию (новые сначала)

  2. ИНТЕРФЕЙС ВЫБОРА НЕДЕЛИ

  - Если найдена 1 неделя: показать диалог подтверждения "Создать отчет?"
  - Если несколько недель: показать HTML-диалог выбора с кнопками для каждой
  недели
  - Ожидание выбора через PropertiesService (максимум 30 секунд)

  3. СОЗДАНИЕ ОТЧЕТОВ ПО КОМАНДАМ

  Для каждой команды (Team 1-5):

  3.1 ПОИСК БЛОКА НЕДЕЛИ

  - Находит колонку с заголовком "WEEK {номер}"
  - Вычисляет колонки дней: WEEK колонка - 8 позиций
  - Возвращает: {daysStartCol, weekGrossCol}

  3.2 СОЗДАНИЕ ВЫХОДНОГО ЛИСТА

  - Имя листа: "{TeamName} {YYYY-MM-DD}"
  - Очищает содержимое если лист существует

  3.3 КОПИРОВАНИЕ ЗАГОЛОВКОВ

  Структура заголовка (11 колонок):
  1. Колонка A: заголовок колонки E (Dispatcher)
  2. Колонка B: заголовок колонки F (Driver)
  3. Колонки C-I: заголовки 7 дней недели
  4. Колонка J: заголовок WEEK
  5. Колонка K: "ACTIVE DRIVERS"

  Форматирование заголовка:
  - Шрифт: жирный
  - Фон: #4a4a4a (темно-серый)
  - Цвет текста: белый

  3.4 КОПИРОВАНИЕ И ОБРАБОТКА ДАННЫХ

  Для каждой строки данных:

  Чтение данных:
  - E:F → диспетчер, водитель
  - Дни недели → массив значений по дням
  - WEEK → недельный GROSS

  Определение статуса водителя:
  1. Если все 7 дней = "BREAK": статус = "break", фон = #ff8800 (оранжевый)
  2. Если GROSS > 6999:
    - Если BREAK дней ≥ 3: "worked part-time, but hit the target", фон = #0080ff
   (синий)
    - Иначе: "full week - hit the target", фон = #00ff00 (зеленый)
  3. Если GROSS ≤ 6999:
    - Подсчет "проблем" в днях (пустые, 0, отрицательные, "BREAK", etc.)
    - Если проблем ≥ 2: "worked part-time", фон = #0080ff (синий)
    - Если проблем = 1 ИЛИ GROSS ≥ 6000: "full week - didn't hit the target",
  фон = #ff0000 (красный)
    - Иначе: "worked part-time", фон = #0080ff (синий)

  Группировка по диспетчерам:
  - Строки с черным/серым фоном = разделители диспетчеров
  - Строки с текстом "dispatcher"/"driver" = заголовки
  - Группировка водителей под каждым диспетчером
  - Сортировка водителей внутри группы по GROSS (убывание)

  3.5 ЗАПИСЬ ДАННЫХ

  Структура строки (11 колонок):
  1. A: Dispatcher
  2. B: Driver
  3. C-I: значения 7 дней
  4. J: WEEK GROSS
  5. K: статус водителя

  Форматирование данных:
  - Шрифт: жирный
  - Фон строки статуса: цвет по статусу
  - Границы: черные, средней толщины вокруг всех данных

  3.6 СТАТИСТИКА СПРАВА ОТ ДАННЫХ

  Позиция: колонка M (через 1 колонку от основных данных), строка 2

  Таблица статистики (7 строк, 2 колонки):
  1. "ACTIVE DRIVERS STATISTICS" | "" (заголовок)
  2. "full week - hit the target" | количество
  3. "full week - didn't hit the target" | количество
  4. "worked part-time" | количество
  5. "break" | количество
  6. "worked part-time, but hit the target" | количество
  7. "TOTAL ACTIVE DRIVERS" | общее количество

  Форматирование статистики:
  - Заголовок: фон #4a4a4a, текст белый, жирный
  - "full week - hit the target": фон #00ff00, текст черный, жирный
  - "full week - didn't hit the target": фон #ff0000, текст черный, жирный
  - "worked part-time": фон #0080ff, текст черный, жирный
  - "break": фон #ff8800, текст черный, жирный
  - "worked part-time, but hit the target": фон #0080ff, текст черный, жирный
  - "TOTAL": фон #cccccc, текст черный, жирный
  - Границы: черные, средней толщины вокруг всей таблицы

  3.7 ФИНАЛЬНОЕ ФОРМАТИРОВАНИЕ

  - Автоширина всех колонок
  - Черные границы средней толщины вокруг всех используемых ячеек
  - Разделительная линия между колонкой J (WEEK) и K (ACTIVE DRIVERS)

  4. СВОДНЫЙ ОТЧЕТ ПО ВСЕМ КОМАНДАМ

  Имя листа: "WEEK {номер} SUMMARY {YYYY-MM-DD}"

  Структура сводной таблицы:
  - Заголовки команд с цветной кодировкой
  - Статистика по каждой команде
  - Строка TOTAL с общими итогами
  - Процентные показатели для hit target / didn't hit target
  - Средний GROSS для full week водителей

  КОНСТАНТЫ И НАСТРОЙКИ

  - UG_DATA_START_ROW = 3 - первая строка данных
  - WEEK_DAYS_LEN = 7 - количество дней в неделе
  - TEAM_NAME_PATTERN = /^Team\s+\d+/i - паттерн названий команд
  - Цвета команд: Team 1-5 имеют предопределенные цвета фона

  ОБРАБОТКА ОШИБОК

  - Проверка существования листов команд
  - Проверка наличия недельных блоков
  - Обработка пустых данных
  - Логирование в консоль для отладки
